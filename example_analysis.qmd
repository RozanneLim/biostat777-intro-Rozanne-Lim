---
title: "Example Analysis"
format: html
reference-location: margin
citation-location: margin
---
# Economic and Health Burden of Non-Fatal Injuries 

![Injury](https://www.google.com/url?sa=i&url=https%3A%2F%2Fwww.cdc.gov%2Fsuicide%2Ffacts%2Fdata.html&psig=AOvVaw0nMrY2BFUYYHiG70LZJCtN&ust=1762371320932000&source=images&cd=vfe&opi=89978449&ved=0CBYQjRxqFwoTCJjl-_We2ZADFQAAAAAdAAAAABAE)

This analysis uses data from the CDC Web-based Injury Statistics Query and Reporting System (WISQARS) [reference] on the number of cases and economic costs associated with various mechanisms of non-fatal injuries in 2023. The audience for this analysis are students, researchers, and those who are interested in understanding the magnitude of the economic and health burden of non-fatal injuries in the United States. The WISQARS dashboard and data repository combines data collected from the National Center for Health Statistics, U.S. Census Bureau, and National Electronic Injury Surveillance System. 



::: {.callout-note}
## Original data sources are linked here:

- 
- 
- 
:::


## Data Dictionaries

|Variable | Description | Coding | 
|---------|-------------|--------|
| Sex     | 12          |M = Male| 
| 123     | 123         |   123  |
| 1       | 1           |      1 | 

::: {.callout-important}
-- indicates suppressed value (based on <20 unweighted count, <1,200 weighted count, or coefficient of variation of the estimate >30%);

:::


## Questions of interest
1. What were the top 10 mechanisms of non-fatal injury in 2023? 
2. How does the top 10 mechanisms of non-fatal injury differ by gender in 2023? 
3. Which mechanisms have the highest economic burden associated with non-fatal injuries in 2023?

## Setting up R Environment

**Loading packages**
```{r}
#| output: FALSE
library(readr)
library(tidyverse)
library(dplyr)
library(forcats)
```

**Loading data**
```{r}
#| output: FALSE
costs <- read_csv("cost-data-export.csv")
cases <- read_csv("reports-data-export.csv")
total <- read_csv("total_case.csv")
```

## Data Wrangling 

Before starting data analysis and data visualization, data wrangling is required to ensure that the datasets are in the desired format for better readability and analysis. This includes converting variables into the appropriate type (e.g, factor, numeric, string), merging, and removing rows/columns. 

Using the glimpse function allows us to see the structure of the dataset, and the formats for each of the variables. In both datasets below, all the variables are in the format 'chr' (characters). 

```{r}
glimpse(cases)
glimpse(costs)
```

**Cleaning Cases Data**
```{r}
#| warning: FALSE

#converting categorical variables to factors, continuous rates to numeric variables, and removing columns that will not be used in the analysis, removing rows that are comment lines, and Sex = Unknown
clean_cases <- cases %>%
  slice(-c(66:87)) %>%
  mutate(
    Sex = as.factor(Sex),
    Mechanism = as.factor(Mechanism),
    across(
      c(`Estimated Number`, Population, `Crude Rate`, `Age-Adjusted Rate`),
      ~ as.numeric(str_remove_all(.x, ","))
    )
  ) %>%
  select(
    -c(`Cases (Sample)`, `Standard Error`, CV, `Lower 95% CI`, `Upper 95% CI`)
  ) %>%
  filter(Sex != "Unknown")

```

**Cleaning Costs Data**  
```{r}
#| warning: FALSE

clean_costs <- costs %>%
  slice(-c(65:85)) %>%
  mutate(
    Sex = as.factor(Sex),
    Mechanism = as.factor(Mechanism),
    across(
      c(
        `ED Visits`,
        `Medical Costs Average`,
        `Work Loss Costs Average`,
        `Quality of Life Loss Costs Average`,
        `Combined Costs Average`
      ),
      ~ as.numeric(str_remove_all(.x, "[$,]"))
    )
  ) %>%
  mutate(
    across(
      c(
        `Medical Costs Total`,
        `Work Loss Costs Total`,
        `Quality of Life Loss Costs Total`,
        `Combined Costs Total`
      ),
      ~ case_when(
        str_detect(.x, "B") ~ as.numeric(str_remove_all(.x, "[^0-9.]")) * 1000,
        str_detect(.x, "M") ~ as.numeric(str_remove_all(.x, "[^0-9.]"))
      )
    )
  ) %>%
  filter(Sex != "Unknown")

```

**Cleaning Total Cases Data**

```{r}
#| warning: FALSE

clean_total <- total %>%
  select(
    -c(`Cases (Sample)`, `Standard Error`, CV, `Lower 95% CI`, `Upper 95% CI`)
  ) %>%
  slice(-c(23:44))

```

## Data Analysis 

**Question 1: Which mechanisms of non-fatal injury were the most common in 2023?**

```{r}
clean_total %>%
  arrange(desc(`Age-Adjusted Rate`)) %>%
  slice(1:10) %>%
  ggplot(
    mapping = aes(
      x = `Age-Adjusted Rate`,
      y = fct_reorder(Mechanism, `Age-Adjusted Rate`)
    )
  ) +
  geom_col() +
  labs(
    title = "Top 10 Mechanisms of Non-Fatal Injury in the United States in 2023",
    subtitle = "",
    caption = "Data from CDC WISQARS",
    y = "Mechanism",
    x = "Age-Adjusted Rate (per 100,000 persons)"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(size = 10),
    axis.title.x = element_text(size = 8, face = "bold"),
    axis.title.y = element_text(size = 8, face = "bold"),
    plot.title = element_text(size = 10, face = "bold"),
    plot.title.position = "plot",
    plot.subtitle = element_text(size = 9),
    legend.title = element_text(face = "bold"),
    legend.position = "bottom",
    plot.caption = element_text(size = 5)
  )

```


**Question 2: How does the mechanism of non-fatal injury differ by gender in 2023?** 

```{r}
clean_cases %>%
  group_by(Sex) %>%
  slice_max(order_by = `Age-Adjusted Rate`, n = 10) %>% #new function I looked up to get the top 10 mechanism by Sex
  ungroup() %>%
  ggplot(
    mapping = aes(
      x = `Age-Adjusted Rate`,
      y = fct_reorder(Mechanism, `Age-Adjusted Rate`)
    )
  ) +
  geom_col() +
  facet_wrap(~Sex, nrow = 2, scales = "free_y") +
  labs(
    title = "Top 10 Mechanisms of Non-Fatal Injury by Sex",
    subtitle = "",
    caption = "Data from CDC WISQARS",
    y = "Mechanism",
    x = "Age-Adjusted Rate (per 100,000 persons)"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(size = 10),
    axis.title.x = element_text(size = 8, face = "bold"),
    axis.title.y = element_text(size = 8, face = "bold"),
    plot.title = element_text(size = 10, face = "bold"),
    plot.title.position = "plot",
    plot.subtitle = element_text(size = 9),
    legend.title = element_text(face = "bold"),
    legend.position = "bottom",
    plot.caption = element_text(size = 5)
  )
```

**Question 3: Which mechanisms have the highest economic burden associated with non-fatal injuries in 2023?**

```{r}
clean_costs %>%
  group_by(Sex, Mechanism) %>%

```

## Results 
